Feature: JobUtils Testing

  Scenario: createYarnLogObservable integration test with producing logs by line
    Given mock a http service in JobUtilsScenario for GET request '/batch/9' to return '{"id":9,"state":"starting","appId":"application_1492415936046_0015","appInfo":{"driverLogUrl":"http://127.0.0.1:$port/yarnui/10.0.0.15/node/containerlogs/container_e02_1492415936046_0015_01_000001/livy","sparkUiUrl":"https://spkdbg.azurehdinsight.net/yarnui/hn/proxy/application_1492415936046_0015/"},"log":["\\t ApplicationMaster RPC port: -1","\\t queue: default","\\t start time: 1492569369011","\\t final status: UNDEFINED","\\t tracking URL: https://spkdbg.azurehdinsight.net/yarnui/hn/proxy/application_1492415936046_0015/","\\t user: livy","17/04/19 02:36:09 INFO ShutdownHookManager: Shutdown hook called","17/04/19 02:36:09 INFO ShutdownHookManager: Deleting directory /tmp/spark-1984dc9d-acd4-4648-9104-398431590f8e","YARN Diagnostics:","AM container is launched, waiting for AM container to Register with RM"]}' with status code 200
    And mock a http service in JobUtilsScenario for GET request '/yarnui/10.0.0.15/node/containerlogs/container_e02_1492415936046_0015_01_000001/livy/stderr?start=0&&end=10' to return '<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> <html> <meta http-equiv="X-UA-Compatible" content="IE=8"> <meta http-equiv="Content-type" content="text/html; charset=UTF-8"> <title> Logs for container_e03_1492780173422_0013_02_000001 </title>   <table id="layout" class="ui-widget-content"> <thead> <tr> <td colspan="2"> <div id="header" class="ui-widget"> <div id="user"> Logged in as: dr.who </div> <div id="logo"> <img src="/yarnui/static/hadoop-st.png"> </div> <h1> Logs for container_e03_1492780173422_0013_02_000001 </h1> </div> </td> </tr> </thead> <tfoot> <tr> <td colspan="2"> <div id="footer" class="ui-widget"> </div> </td> </tr> </tfoot> <tbody> <tr> <td id="navcell"> <div id="nav"> <h3> ResourceManager </h3> <ul> <li> <a href="/yarnui/hn/">RM Home</a> </ul> <h3> NodeManager </h3> <ul> <li> <a href="/yarnui/10.0.0.15/node/node">Node Information</a> <li> <a href="/yarnui/10.0.0.15/node/allApplications">List of Applications</a> <li> <a href="/yarnui/10.0.0.15/node/allContainers">List of Containers</a> </ul> <h3> Tools </h3> <ul> <li> <a href="/yarnui/10.0.0.15/conf">Configuration</a> <li> <a href="/yarnui/10.0.0.15/logs">Local logs</a> <li> <a href="/yarnui/10.0.0.15/stacks">Server stacks</a> <li> <a href="/yarnui/10.0.0.15/jmx?qry=Hadoop:*">Server metrics</a> </ul> </div> </td> <td class="content"> <p> Log Type: stderr <pre>line1\nline</pre> </td> </tr> </tbody> </table> </html>' with status code 200
    And mock a http service in JobUtilsScenario for GET request '/yarnui/10.0.0.15/node/containerlogs/container_e02_1492415936046_0015_01_000001/livy/stderr?start=6&&end=16' to return '<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> <html> <meta http-equiv="X-UA-Compatible" content="IE=8"> <meta http-equiv="Content-type" content="text/html; charset=UTF-8"> <title> Logs for container_e03_1492780173422_0013_02_000001 </title>   <table id="layout" class="ui-widget-content"> <thead> <tr> <td colspan="2"> <div id="header" class="ui-widget"> <div id="user"> Logged in as: dr.who </div> <div id="logo"> <img src="/yarnui/static/hadoop-st.png"> </div> <h1> Logs for container_e03_1492780173422_0013_02_000001 </h1> </div> </td> </tr> </thead> <tfoot> <tr> <td colspan="2"> <div id="footer" class="ui-widget"> </div> </td> </tr> </tfoot> <tbody> <tr> <td id="navcell"> <div id="nav"> <h3> ResourceManager </h3> <ul> <li> <a href="/yarnui/hn/">RM Home</a> </ul> <h3> NodeManager </h3> <ul> <li> <a href="/yarnui/10.0.0.15/node/node">Node Information</a> <li> <a href="/yarnui/10.0.0.15/node/allApplications">List of Applications</a> <li> <a href="/yarnui/10.0.0.15/node/allContainers">List of Containers</a> </ul> <h3> Tools </h3> <ul> <li> <a href="/yarnui/10.0.0.15/conf">Configuration</a> <li> <a href="/yarnui/10.0.0.15/logs">Local logs</a> <li> <a href="/yarnui/10.0.0.15/stacks">Server stacks</a> <li> <a href="/yarnui/10.0.0.15/jmx?qry=Hadoop:*">Server metrics</a> </ul> </div> </td> <td class="content"> <p> Log Type: stderr <pre>line2\nline</pre> </td> </tr> </tbody> </table> </html>' with status code 200
    And mock a http service in JobUtilsScenario for GET request '/yarnui/10.0.0.15/node/containerlogs/container_e02_1492415936046_0015_01_000001/livy/stderr?start=12&&end=22' to return '<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> <html> <meta http-equiv="X-UA-Compatible" content="IE=8"> <meta http-equiv="Content-type" content="text/html; charset=UTF-8"> <title> Logs for container_e03_1492780173422_0013_02_000001 </title>   <table id="layout" class="ui-widget-content"> <thead> <tr> <td colspan="2"> <div id="header" class="ui-widget"> <div id="user"> Logged in as: dr.who </div> <div id="logo"> <img src="/yarnui/static/hadoop-st.png"> </div> <h1> Logs for container_e03_1492780173422_0013_02_000001 </h1> </div> </td> </tr> </thead> <tfoot> <tr> <td colspan="2"> <div id="footer" class="ui-widget"> </div> </td> </tr> </tfoot> <tbody> <tr> <td id="navcell"> <div id="nav"> <h3> ResourceManager </h3> <ul> <li> <a href="/yarnui/hn/">RM Home</a> </ul> <h3> NodeManager </h3> <ul> <li> <a href="/yarnui/10.0.0.15/node/node">Node Information</a> <li> <a href="/yarnui/10.0.0.15/node/allApplications">List of Applications</a> <li> <a href="/yarnui/10.0.0.15/node/allContainers">List of Containers</a> </ul> <h3> Tools </h3> <ul> <li> <a href="/yarnui/10.0.0.15/conf">Configuration</a> <li> <a href="/yarnui/10.0.0.15/logs">Local logs</a> <li> <a href="/yarnui/10.0.0.15/stacks">Server stacks</a> <li> <a href="/yarnui/10.0.0.15/jmx?qry=Hadoop:*">Server metrics</a> </ul> </div> </td> <td class="content"> <p> Log Type: stderr <pre>line3\n</pre> </td> </tr> </tbody> </table> </html>' with status code 200
    And mock a http service in JobUtilsScenario for GET request '/yarnui/10.0.0.15/node/containerlogs/container_e02_1492415936046_0015_01_000001/livy/stderr?start=18&&end=28' to return '<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> <html> <meta http-equiv="X-UA-Compatible" content="IE=8"> <meta http-equiv="Content-type" content="text/html; charset=UTF-8"> <title> Logs for container_e03_1492780173422_0013_02_000001 </title>   <table id="layout" class="ui-widget-content"> <thead> <tr> <td colspan="2"> <div id="header" class="ui-widget"> <div id="user"> Logged in as: dr.who </div> <div id="logo"> <img src="/yarnui/static/hadoop-st.png"> </div> <h1> Logs for container_e03_1492780173422_0013_02_000001 </h1> </div> </td> </tr> </thead> <tfoot> <tr> <td colspan="2"> <div id="footer" class="ui-widget"> </div> </td> </tr> </tfoot> <tbody> <tr> <td id="navcell"> <div id="nav"> <h3> ResourceManager </h3> <ul> <li> <a href="/yarnui/hn/">RM Home</a> </ul> <h3> NodeManager </h3> <ul> <li> <a href="/yarnui/10.0.0.15/node/node">Node Information</a> <li> <a href="/yarnui/10.0.0.15/node/allApplications">List of Applications</a> <li> <a href="/yarnui/10.0.0.15/node/allContainers">List of Containers</a> </ul> <h3> Tools </h3> <ul> <li> <a href="/yarnui/10.0.0.15/conf">Configuration</a> <li> <a href="/yarnui/10.0.0.15/logs">Local logs</a> <li> <a href="/yarnui/10.0.0.15/stacks">Server stacks</a> <li> <a href="/yarnui/10.0.0.15/jmx?qry=Hadoop:*">Server metrics</a> </ul> </div> </td> <td class="content"> <p> Log Type: stderr <pre></pre> </td> </tr> </tbody> </table> </html>' with status code 200
    And mock a http service in JobUtilsScenario for GET request '/yarnui/10.0.0.15/node/containerlogs/container_e02_1492415936046_0015_01_000001/livy/stderr?start=18' to return '<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> <html> <meta http-equiv="X-UA-Compatible" content="IE=8"> <meta http-equiv="Content-type" content="text/html; charset=UTF-8"> <title> Logs for container_e03_1492780173422_0013_02_000001 </title>   <table id="layout" class="ui-widget-content"> <thead> <tr> <td colspan="2"> <div id="header" class="ui-widget"> <div id="user"> Logged in as: dr.who </div> <div id="logo"> <img src="/yarnui/static/hadoop-st.png"> </div> <h1> Logs for container_e03_1492780173422_0013_02_000001 </h1> </div> </td> </tr> </thead> <tfoot> <tr> <td colspan="2"> <div id="footer" class="ui-widget"> </div> </td> </tr> </tfoot> <tbody> <tr> <td id="navcell"> <div id="nav"> <h3> ResourceManager </h3> <ul> <li> <a href="/yarnui/hn/">RM Home</a> </ul> <h3> NodeManager </h3> <ul> <li> <a href="/yarnui/10.0.0.15/node/node">Node Information</a> <li> <a href="/yarnui/10.0.0.15/node/allApplications">List of Applications</a> <li> <a href="/yarnui/10.0.0.15/node/allContainers">List of Containers</a> </ul> <h3> Tools </h3> <ul> <li> <a href="/yarnui/10.0.0.15/conf">Configuration</a> <li> <a href="/yarnui/10.0.0.15/logs">Local logs</a> <li> <a href="/yarnui/10.0.0.15/stacks">Server stacks</a> <li> <a href="/yarnui/10.0.0.15/jmx?qry=Hadoop:*">Server metrics</a> </ul> </div> </td> <td class="content"> <p> Log Type: stderr <pre></pre> </td> </tr> </tbody> </table> </html>' with status code 200
    Then Yarn log observable from '/yarnui/10.0.0.15/node/containerlogs/container_e02_1492415936046_0015_01_000001/livy' should produce events:
      | line1 |
      | line2 |
      | line3 |

  Scenario: createYarnLogObservable integration test with producing super long logs cross block
    Given mock a http service in JobUtilsScenario for GET request '/batch/9' to return '{"id":9,"state":"starting","appId":"application_1492415936046_0015","appInfo":{"driverLogUrl":"http://127.0.0.1:$port/yarnui/10.0.0.15/node/containerlogs/container_e02_1492415936046_0015_01_000001/livy","sparkUiUrl":"https://spkdbg.azurehdinsight.net/yarnui/hn/proxy/application_1492415936046_0015/"},"log":["\\t ApplicationMaster RPC port: -1","\\t queue: default","\\t start time: 1492569369011","\\t final status: UNDEFINED","\\t tracking URL: https://spkdbg.azurehdinsight.net/yarnui/hn/proxy/application_1492415936046_0015/","\\t user: livy","17/04/19 02:36:09 INFO ShutdownHookManager: Shutdown hook called","17/04/19 02:36:09 INFO ShutdownHookManager: Deleting directory /tmp/spark-1984dc9d-acd4-4648-9104-398431590f8e","YARN Diagnostics:","AM container is launched, waiting for AM container to Register with RM"]}' with status code 200
    And mock a http service in JobUtilsScenario for GET request '/yarnui/10.0.0.15/node/containerlogs/container_e02_1492415936046_0015_01_000001/livy/stderr?start=0&&end=10' to return '<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> <html> <meta http-equiv="X-UA-Compatible" content="IE=8"> <meta http-equiv="Content-type" content="text/html; charset=UTF-8"> <title> Logs for container_e03_1492780173422_0013_02_000001 </title>   <table id="layout" class="ui-widget-content"> <thead> <tr> <td colspan="2"> <div id="header" class="ui-widget"> <div id="user"> Logged in as: dr.who </div> <div id="logo"> <img src="/yarnui/static/hadoop-st.png"> </div> <h1> Logs for container_e03_1492780173422_0013_02_000001 </h1> </div> </td> </tr> </thead> <tfoot> <tr> <td colspan="2"> <div id="footer" class="ui-widget"> </div> </td> </tr> </tfoot> <tbody> <tr> <td id="navcell"> <div id="nav"> <h3> ResourceManager </h3> <ul> <li> <a href="/yarnui/hn/">RM Home</a> </ul> <h3> NodeManager </h3> <ul> <li> <a href="/yarnui/10.0.0.15/node/node">Node Information</a> <li> <a href="/yarnui/10.0.0.15/node/allApplications">List of Applications</a> <li> <a href="/yarnui/10.0.0.15/node/allContainers">List of Containers</a> </ul> <h3> Tools </h3> <ul> <li> <a href="/yarnui/10.0.0.15/conf">Configuration</a> <li> <a href="/yarnui/10.0.0.15/logs">Local logs</a> <li> <a href="/yarnui/10.0.0.15/stacks">Server stacks</a> <li> <a href="/yarnui/10.0.0.15/jmx?qry=Hadoop:*">Server metrics</a> </ul> </div> </td> <td class="content"> <p> Log Type: stderr <pre>line1\n1234</pre> </td> </tr> </tbody> </table> </html>' with status code 200
    And mock a http service in JobUtilsScenario for GET request '/yarnui/10.0.0.15/node/containerlogs/container_e02_1492415936046_0015_01_000001/livy/stderr?start=6&&end=16' to return '<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> <html> <meta http-equiv="X-UA-Compatible" content="IE=8"> <meta http-equiv="Content-type" content="text/html; charset=UTF-8"> <title> Logs for container_e03_1492780173422_0013_02_000001 </title>   <table id="layout" class="ui-widget-content"> <thead> <tr> <td colspan="2"> <div id="header" class="ui-widget"> <div id="user"> Logged in as: dr.who </div> <div id="logo"> <img src="/yarnui/static/hadoop-st.png"> </div> <h1> Logs for container_e03_1492780173422_0013_02_000001 </h1> </div> </td> </tr> </thead> <tfoot> <tr> <td colspan="2"> <div id="footer" class="ui-widget"> </div> </td> </tr> </tfoot> <tbody> <tr> <td id="navcell"> <div id="nav"> <h3> ResourceManager </h3> <ul> <li> <a href="/yarnui/hn/">RM Home</a> </ul> <h3> NodeManager </h3> <ul> <li> <a href="/yarnui/10.0.0.15/node/node">Node Information</a> <li> <a href="/yarnui/10.0.0.15/node/allApplications">List of Applications</a> <li> <a href="/yarnui/10.0.0.15/node/allContainers">List of Containers</a> </ul> <h3> Tools </h3> <ul> <li> <a href="/yarnui/10.0.0.15/conf">Configuration</a> <li> <a href="/yarnui/10.0.0.15/logs">Local logs</a> <li> <a href="/yarnui/10.0.0.15/stacks">Server stacks</a> <li> <a href="/yarnui/10.0.0.15/jmx?qry=Hadoop:*">Server metrics</a> </ul> </div> </td> <td class="content"> <p> Log Type: stderr <pre>1234567890</pre> </td> </tr> </tbody> </table> </html>' with status code 200
    And mock a http service in JobUtilsScenario for GET request '/yarnui/10.0.0.15/node/containerlogs/container_e02_1492415936046_0015_01_000001/livy/stderr?start=16&&end=26' to return '<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> <html> <meta http-equiv="X-UA-Compatible" content="IE=8"> <meta http-equiv="Content-type" content="text/html; charset=UTF-8"> <title> Logs for container_e03_1492780173422_0013_02_000001 </title>   <table id="layout" class="ui-widget-content"> <thead> <tr> <td colspan="2"> <div id="header" class="ui-widget"> <div id="user"> Logged in as: dr.who </div> <div id="logo"> <img src="/yarnui/static/hadoop-st.png"> </div> <h1> Logs for container_e03_1492780173422_0013_02_000001 </h1> </div> </td> </tr> </thead> <tfoot> <tr> <td colspan="2"> <div id="footer" class="ui-widget"> </div> </td> </tr> </tfoot> <tbody> <tr> <td id="navcell"> <div id="nav"> <h3> ResourceManager </h3> <ul> <li> <a href="/yarnui/hn/">RM Home</a> </ul> <h3> NodeManager </h3> <ul> <li> <a href="/yarnui/10.0.0.15/node/node">Node Information</a> <li> <a href="/yarnui/10.0.0.15/node/allApplications">List of Applications</a> <li> <a href="/yarnui/10.0.0.15/node/allContainers">List of Containers</a> </ul> <h3> Tools </h3> <ul> <li> <a href="/yarnui/10.0.0.15/conf">Configuration</a> <li> <a href="/yarnui/10.0.0.15/logs">Local logs</a> <li> <a href="/yarnui/10.0.0.15/stacks">Server stacks</a> <li> <a href="/yarnui/10.0.0.15/jmx?qry=Hadoop:*">Server metrics</a> </ul> </div> </td> <td class="content"> <p> Log Type: stderr <pre>abcd\n</pre> </td> </tr> </tbody> </table> </html>' with status code 200
    And mock a http service in JobUtilsScenario for GET request '/yarnui/10.0.0.15/node/containerlogs/container_e02_1492415936046_0015_01_000001/livy/stderr?start=21' to return '<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> <html> <meta http-equiv="X-UA-Compatible" content="IE=8"> <meta http-equiv="Content-type" content="text/html; charset=UTF-8"> <title> Logs for container_e03_1492780173422_0013_02_000001 </title>   <table id="layout" class="ui-widget-content"> <thead> <tr> <td colspan="2"> <div id="header" class="ui-widget"> <div id="user"> Logged in as: dr.who </div> <div id="logo"> <img src="/yarnui/static/hadoop-st.png"> </div> <h1> Logs for container_e03_1492780173422_0013_02_000001 </h1> </div> </td> </tr> </thead> <tfoot> <tr> <td colspan="2"> <div id="footer" class="ui-widget"> </div> </td> </tr> </tfoot> <tbody> <tr> <td id="navcell"> <div id="nav"> <h3> ResourceManager </h3> <ul> <li> <a href="/yarnui/hn/">RM Home</a> </ul> <h3> NodeManager </h3> <ul> <li> <a href="/yarnui/10.0.0.15/node/node">Node Information</a> <li> <a href="/yarnui/10.0.0.15/node/allApplications">List of Applications</a> <li> <a href="/yarnui/10.0.0.15/node/allContainers">List of Containers</a> </ul> <h3> Tools </h3> <ul> <li> <a href="/yarnui/10.0.0.15/conf">Configuration</a> <li> <a href="/yarnui/10.0.0.15/logs">Local logs</a> <li> <a href="/yarnui/10.0.0.15/stacks">Server stacks</a> <li> <a href="/yarnui/10.0.0.15/jmx?qry=Hadoop:*">Server metrics</a> </ul> </div> </td> <td class="content"> <p> Log Type: stderr <pre></pre> </td> </tr> </tbody> </table> </html>' with status code 200
    And mock a http service in JobUtilsScenario for GET request '/yarnui/10.0.0.15/node/containerlogs/container_e02_1492415936046_0015_01_000001/livy/stderr?start=21&&end=31' to return '<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> <html> <meta http-equiv="X-UA-Compatible" content="IE=8"> <meta http-equiv="Content-type" content="text/html; charset=UTF-8"> <title> Logs for container_e03_1492780173422_0013_02_000001 </title>   <table id="layout" class="ui-widget-content"> <thead> <tr> <td colspan="2"> <div id="header" class="ui-widget"> <div id="user"> Logged in as: dr.who </div> <div id="logo"> <img src="/yarnui/static/hadoop-st.png"> </div> <h1> Logs for container_e03_1492780173422_0013_02_000001 </h1> </div> </td> </tr> </thead> <tfoot> <tr> <td colspan="2"> <div id="footer" class="ui-widget"> </div> </td> </tr> </tfoot> <tbody> <tr> <td id="navcell"> <div id="nav"> <h3> ResourceManager </h3> <ul> <li> <a href="/yarnui/hn/">RM Home</a> </ul> <h3> NodeManager </h3> <ul> <li> <a href="/yarnui/10.0.0.15/node/node">Node Information</a> <li> <a href="/yarnui/10.0.0.15/node/allApplications">List of Applications</a> <li> <a href="/yarnui/10.0.0.15/node/allContainers">List of Containers</a> </ul> <h3> Tools </h3> <ul> <li> <a href="/yarnui/10.0.0.15/conf">Configuration</a> <li> <a href="/yarnui/10.0.0.15/logs">Local logs</a> <li> <a href="/yarnui/10.0.0.15/stacks">Server stacks</a> <li> <a href="/yarnui/10.0.0.15/jmx?qry=Hadoop:*">Server metrics</a> </ul> </div> </td> <td class="content"> <p> Log Type: stderr <pre></pre> </td> </tr> </tbody> </table> </html>' with status code 200
    Then Yarn log observable from '/yarnui/10.0.0.15/node/containerlogs/container_e02_1492415936046_0015_01_000001/livy' should produce events:
      | line1 |
      | 1234567890abcd |

  Scenario: getInformationFromYarnLogDom can read YarnUI log format
    Given mock a http service in JobUtilsScenario for GET request '/yarnui/10.0.0.15/node/containerlogs/container_e02_1492415936046_0015_01_000001/livy/stderr?start=0' to return '<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> <html> <meta http-equiv="X-UA-Compatible" content="IE=8"> <meta http-equiv="Content-type" content="text/html; charset=UTF-8"> <title> Logs for container_e03_1492780173422_0013_02_000001 </title>   <table id="layout" class="ui-widget-content"> <thead> <tr> <td colspan="2"> <div id="header" class="ui-widget"> <div id="user"> Logged in as: dr.who </div> <div id="logo"> <img src="/yarnui/static/hadoop-st.png"> </div> <h1> Logs for container_e03_1492780173422_0013_02_000001 </h1> </div> </td> </tr> </thead> <tfoot> <tr> <td colspan="2"> <div id="footer" class="ui-widget"> </div> </td> </tr> </tfoot> <tbody> <tr> <td id="navcell"> <div id="nav"> <h3> ResourceManager </h3> <ul> <li> <a href="/yarnui/hn/">RM Home</a> </ul> <h3> NodeManager </h3> <ul> <li> <a href="/yarnui/10.0.0.15/node/node">Node Information</a> <li> <a href="/yarnui/10.0.0.15/node/allApplications">List of Applications</a> <li> <a href="/yarnui/10.0.0.15/node/allContainers">List of Containers</a> </ul> <h3> Tools </h3> <ul> <li> <a href="/yarnui/10.0.0.15/conf">Configuration</a> <li> <a href="/yarnui/10.0.0.15/logs">Local logs</a> <li> <a href="/yarnui/10.0.0.15/stacks">Server stacks</a> <li> <a href="/yarnui/10.0.0.15/jmx?qry=Hadoop:*">Server metrics</a> </ul> </div> </td> <td class="content"> <p>"some"</p><pre>runninglog</pre> </td> </tr> </tbody> </table> </html>' with status code 200
    Then get YarnUI log 'stderr' from '/yarnui/10.0.0.15/node/containerlogs/container_e02_1492415936046_0015_01_000001/livy' should return 'runninglog'

  Scenario: getInformationFromYarnLogDom can read Spark 2.0/2.1 Yarn History server log format
    Given mock a http service in JobUtilsScenario for GET request '/yarnui/10.0.0.15/node/containerlogs/container_e02_1492415936046_0015_01_000001/livy/stderr?start=0' to return '<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> <html> <meta http-equiv="X-UA-Compatible" content="IE=8"> <meta http-equiv="Content-type" content="text/html; charset=UTF-8"> <title> Logs for container_e03_1492780173422_0013_02_000001 </title>   <table id="layout" class="ui-widget-content"> <thead> <tr> <td colspan="2"> <div id="header" class="ui-widget"> <div id="user"> Logged in as: dr.who </div> <div id="logo"> <img src="/yarnui/static/hadoop-st.png"> </div> <h1> Logs for container_e03_1492780173422_0013_02_000001 </h1> </div> </td> </tr> </thead> <tfoot> <tr> <td colspan="2"> <div id="footer" class="ui-widget"> </div> </td> </tr> </tfoot> <tbody> <tr> <td id="navcell"> <div id="nav"> <h3> ResourceManager </h3> <ul> <li> <a href="/yarnui/hn/">RM Home</a> </ul> <h3> NodeManager </h3> <ul> <li> <a href="/yarnui/10.0.0.15/node/node">Node Information</a> <li> <a href="/yarnui/10.0.0.15/node/allApplications">List of Applications</a> <li> <a href="/yarnui/10.0.0.15/node/allContainers">List of Containers</a> </ul> <h3> Tools </h3> <ul> <li> <a href="/yarnui/10.0.0.15/conf">Configuration</a> <li> <a href="/yarnui/10.0.0.15/logs">Local logs</a> <li> <a href="/yarnui/10.0.0.15/stacks">Server stacks</a> <li> <a href="/yarnui/10.0.0.15/jmx?qry=Hadoop:*">Server metrics</a> </ul> </div> </td> <td class="content"> <p> Log Type: stderr <pre>abc</pre> </td> </tr> </tbody> </table> </html>' with status code 200
    Then get YarnUI log 'stderr' from '/yarnui/10.0.0.15/node/containerlogs/container_e02_1492415936046_0015_01_000001/livy' should return 'abc'

  Scenario: getInformationFromYarnLogDom can read Spark 2.2 Yarn History server log format
    Given mock a http service in JobUtilsScenario for GET request '/yarnui/10.0.0.15/node/containerlogs/container_e02_1492415936046_0015_01_000001/livy/stderr?start=0' to return '<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> <html> <meta http-equiv="X-UA-Compatible" content="IE=8"> <meta http-equiv="Content-type" content="text/html; charset=UTF-8"> <title> Logs for container_e03_1492780173422_0013_02_000001 </title>   <table id="layout" class="ui-widget-content"> <thead> <tr> <td colspan="2"> <div id="header" class="ui-widget"> <div id="user"> Logged in as: dr.who </div> <div id="logo"> <img src="/yarnui/static/hadoop-st.png"> </div> <h1> Logs for container_e03_1492780173422_0013_02_000001 </h1> </div> </td> </tr> </thead> <tfoot> <tr> <td colspan="2"> <div id="footer" class="ui-widget"> </div> </td> </tr> </tfoot> <tbody> <tr> <td id="navcell"> <div id="nav"> <h3> ResourceManager </h3> <ul> <li> <a href="/yarnui/hn/">RM Home</a> </ul> <h3> NodeManager </h3> <ul> <li> <a href="/yarnui/10.0.0.15/node/node">Node Information</a> <li> <a href="/yarnui/10.0.0.15/node/allApplications">List of Applications</a> <li> <a href="/yarnui/10.0.0.15/node/allContainers">List of Containers</a> </ul> <h3> Tools </h3> <ul> <li> <a href="/yarnui/10.0.0.15/conf">Configuration</a> <li> <a href="/yarnui/10.0.0.15/logs">Local logs</a> <li> <a href="/yarnui/10.0.0.15/stacks">Server stacks</a> <li> <a href="/yarnui/10.0.0.15/jmx?qry=Hadoop:*">Server metrics</a> </ul> </div> </td> <td class="content"> <pre>\n\n</pre> <p> Log Type: stderr <pre>spark2.2stderr</pre> </td> </tr> </tbody> </table> </html>' with status code 200
    Then get YarnUI log 'stderr' from '/yarnui/10.0.0.15/node/containerlogs/container_e02_1492415936046_0015_01_000001/livy' should return 'spark2.2stderr'
